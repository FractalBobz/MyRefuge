{% extends "base.html" %}
{% load i18n sekizai_tags staticfiles %}

{% block head %}
{{ wizard.form.media }}
{% endblock %}

{% block title %}MyRefuge - {% trans "Provide Space" %}{% endblock %}

{% block header %}{% endblock %}

{% block content %}
<div id="account">
    <div class="white-sheet">
        <h4 class="title">{% trans "Describle your space" %}</h4>

        <form action="" method="post" enctype="multipart/form-data">{% csrf_token %}
            {% for dict in wizard.errors %}
    {% for error in dict.values %}
        Please correct the error: {{ error }}
    {% endfor %}
{% endfor %}
            {{ wizard.management_form }}
            {% if wizard.form.forms %}
                {{ wizard.form.management_form }}
                {% for wizardform in wizard.form.forms|slice:":1" %}
                    {% include "form/input.html" with field=wizardform.headline label="Headline description" required=wizardform.fields.headline.required %}
                    {% include "form/input.html" with field=wizardform.address label="Address of the available space" required=wizardform.fields.address.required %}
                    {% include "form/input.html" with field=wizardform.guests label="Number of guests to accommodate" revealType=True required=wizardform.fields.guests.required %}
                    <div class="vr-1 checkboxs inline">
                        {{wizardform.additional}}
                    </div>

                    <label class="vr-1 form-title">Avalibility</label>
                    {% for dateform in wizard.form.forms %}
                    <div class="form-inner">
                        {% include "form/input.html" with field=dateform.start_date label="From" type="hidden" sr=False name="space-start_date_" required=dateform.fields.start_date.required class="date-block right" %}
                        {% include "form/input.html" with field=dateform.end_date label="To" type="hidden" sr=False name="space-end_date_" required=dateform.fields.end_date.required class="date-block right" %}
                    </div>
                    {% endfor %}

                    {% include "form/textarea.html" with field=wizardform.full_description label=wizardform.full_description.label required=wizardform.fields.full_description.required %}
                    {% include "form/input.html" with field=wizardform.mugshot label="Photo" sr=False %}
                {% endfor %}
            {% else %}
                {% include "form/input.html" with field=wizard.form.headline label="Headline description" required=wizard.form.fields.headline.required %}
                {% include "form/input.html" with field=wizard.form.address label="Address of the available space" required=wizard.form.fields.address.required %}
                {% include "form/input.html" with field=wizard.form.guests label="Number of guests to accommodate" revealType=True required=wizard.form.fields.guests.required %}
                <div class="vr-1 checkboxs inline">
                    {{wizard.form.additional}}
                </div>

                <label class="vr-1 form-title">Avalibility</label>
                <div class="form-inner">
                    {% include "form/input.html" with field=wizard.form.start_date label="From" type="hidden" sr=False name="space-start_date_" required=wizard.form.fields.start_date.required class="date-block right" %}
                    {% include "form/input.html" with field=wizard.form.end_date label="To" type="hidden" sr=False name="space-end_date_" required=wizard.form.fields.end_date.required class="date-block right" %}
                </div>

                {% include "form/textarea.html" with field=wizard.form.full_description label=wizard.form.full_description.label required=wizard.form.fields.full_description.required %}
                {% include "form/input.html" with field=wizard.form.mugshot label="Photo" sr=False %}
            {% endif %}

            <input class="btn btn-block btn-primary" type="submit" value="{% trans "Share this space with a refugee!" %}"/>
        </form>
    </div>
</div>

{% endblock %}


{% block js_ %}
    <script src="http://maps.googleapis.com/maps/api/js?libraries=places&sensor=false" type="text/javascript"></script>
    <script src="{% static "js/jquery.geocomplete.min.js" %}" type="text/javascript"></script>
    <script src="{% static "address/js/address.js" %}" type="text/javascript"></script>
    <script src="{% static "js/jquery.formset.js" %}" type="text/javascript"></script>
    <script type="text/javascript">
        (function () {
            whenAvailable('google', function() {
                $("#id_space-address").geocomplete();
            });
            function createDatepicker(id) {
                $('#' + id).dateDropdowns({
                    submitFormat: "dd/mm/yyyy",
                    submitFieldName: id.replace('id_',''),
                    wrapperClass: "date-dropdowns inline",
                    defaultDateFormat: "dd/mm/yyyy",
                    defaultDate: $('#' + id).val(),
                    minAge: -100,
                    maxAge: -1
                });
            }

            $(function() {
                $('form .form-inner').formset({
                    prefix: '{{ wizard.form.prefix }}',
                    addText: 'Add period of availability',
                    deleteText: 'Remove',
                    addCssClass: 'btn-add-form primary',
                    deleteCssClass: 'btn-remove-form primary'
                });

                $('.btn-add-form').click(function () {
                    $('.form-inner').last().find('.date-block input').each(function() {
                        createDatepicker($(this).attr('id'));
                    });
                });
                $('.date-block input').each(function() {
                    createDatepicker($(this).attr('id'));
                });
            });
        })();
        
    </script>
{% endblock %}
