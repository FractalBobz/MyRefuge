{% extends 'base.html' %}
{% load i18n %}
{% load i18n sekizai_tags staticfiles %}
{% load url from future %}
{% load common_filters %}

{% block title %}{% trans "Search for places" %}{% endblock %}
{% block body_class %}search search-bg hide-brand{% endblock %}


{% block css_ %}
<link rel="stylesheet" href="{% static "bootstrap-datepicker/dist/css/bootstrap-datepicker3.css" %}" />
{% endblock %}


{% block content %}

<div class="container-fluid">
    <div class="row search-wrapper">
        <form action="{% url 'search' %}" class="container-inner narrow form-inline search-form">
            {% include "form/search-block.html" with form=form %}
            <button type="submit" class="btn btn-primary">Search</button>
        </form>
    </div>
    <div class="greeting">
        <h1 class="title">{% trans "Welcome home" %}</h1>
        <h3 class="subtitle">{% trans "Find a place to stay with hosts around the world" %}</h3>
    </div>
    <div class="counters">
      <h2 class="spaces-counter">{{ spaces_number }} spaces provided</h2>
      <h2 class="refugees-counter">{{ refugees_number }} refugees registered</h2>
    </div>
</div>

{% endblock %}

{% block js_ %}
    <script src="http://maps.googleapis.com/maps/api/js?libraries=places&sensor=false" type="text/javascript"></script>
    <script src="{% static "js/jquery.geocomplete.min.js" %}" type="text/javascript"></script>
    <script src="{% static "address/js/address.js" %}" type="text/javascript"></script>
    <script src="{% static "bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js" %}" type="text/javascript"></script>

    <script type="text/javascript">
        whenAvailable('google', function() {
            $("#{{form.address.id_for_label}}").geocomplete();
        });
        $(function() {
            var $from = $('.form-group.from input'),
                $to = $('.form-group.to input');

            if (window.innerWidth > 991) {
                $('#provider-places').css('min-height', (window.innerHeight-$('.navbar.navbar-refugee').height()) + 'px');
            }
             
            $from.datepicker({
                    format: 'dd/mm/yyyy',
                    startDate: '0d'
                })
                .on('changeDate', function(ev) {
                    if (ev.date.valueOf() > checkout.viewDate.valueOf()) {
                        checkout.setStartDate(ev.date);
                    }
                    checkin.hide();
                    $to.focus();
                });

            $to.datepicker({
                    format: 'dd/mm/yyyy',
                    startDate: '1d'
                })
                .on('changeDate', function(ev) {
                    checkout.hide();
                });

            var checkin = $from.data('datepicker'),
                checkout = $to.data('datepicker');
        });
    </script>
{% endblock %}
